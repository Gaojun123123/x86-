     1                                  
     2                                          ;代码清单6-1
     3                                          ;文件名:ch6_test
     4                                          ;文件说明：硬盘主引导扇区代码
     5                                          ;创建日期：  2020-7-25 21:46
     6 00000000 E92200                           jmp near start  ;转移到后面的start标号处执行
     7                                  
     8 00000003 4C076107620765076C-       mytext db 'L',0x07,'a',0x07,'b',0x07,'e',0x07,'l',0x07,' ',0x07,'o',0x07,            'f',0x07,'f',0x07,'s',0x07,'e',0x07,'t',0x07,':',0x07      ;声明显示内容
     9 0000000C 0720076F0766076607-
    10 00000015 7307650774073A07   
    11                                  
    12 0000001D E90500                           jmp near start   ;   转移到后面start标号处执行
    13                                  
    14 00000020 0000000000                number db 0,0,0,0,0;number存显示地址
    15                                    start:
    16 00000025 B8C007                          mov ax,0x7c0;   设置数据段地址，主引导扇区的初始地址
    17 00000028 8ED8                            mov ds,ax;
    18                                  
    19 0000002A B800B8                          mov ax,0xb800       ;设置附加段基地址，，显示的基址
    20 0000002D 8EC0                            mov es,ax
    21                                  
    22 0000002F FC                              cld                   ;方向标志指令清零，表示传送是正方向的
    23 00000030 BE[0300]                        mov si,mytext           ;设置串源首地址到si
    24 00000033 BF0000                          mov di,0                 ;目的首地址
    25 00000036 B90E00                          mov cx,(number-mytext)/2   ;实际上等于13  传送字数
    26 00000039 F3A5                            rep movsw          ;每次传送一个字，执行一次cx减1，当cx为0时停止
    27                                  
    28                                          ;得到标号所代表的偏移地址
    29 0000003B B8[2000]                        mov ax,number      ;要显示number所代表的地址
    30                                  
    31                                          ;计算各个数位
    32 0000003E 89C3                            mov bx,ax
    33 00000040 B90500                          mov cx,5           ;循环次数
    34 00000043 BE0A00                          mov si,10           ;除数
    35                                    digit:
    36 00000046 31D2                           xor dx,dx         ;dx清零
    37 00000048 F7F6                           div si
    38 0000004A 8817                           mov [bx],dl        ;保存数位     ，偏移地址来自寄存器
    39 0000004C 43                             inc bx               ;将bx的内容加1
    40 0000004D E2F7                           loop digit       ;循环指令 ：将cx的内容减1，如果cx的内容非零，转移到指定的位置执行 ，否则顺序执行后面的指令
    41                                  
    42                                         ;显示各个数位
    43 0000004F BB[2000]                       mov bx,number
    44 00000052 BE0400                         mov si,4     ;首先显示万位的数字
    45                                    show:
    46 00000055 8A00                           mov al,[bx+si]
    47 00000057 0430                           add al,0x30  ;得到ASCII码
    48 00000059 B404                           mov ah,0x04   ;红色字
    49 0000005B 268905                         mov [es:di],ax
    50 0000005E 83C702                         add di,2        ;指向下一个单元
    51 00000061 4E                             dec si      ;si减1  ，使其指向千位
    52 00000062 79F1                           jns show    ;条件转移指令  ：当 SF状态标志(符号标志)不为1时转移
    53                                  
    54 00000064 26C7054407                     mov word[es:di],0x744
    55                                  
    56 00000069 E9FDFF                         jmp near $           ;死循环
    57                                  
    58 0000006C 00<rept>                   times 510-($-$$) db 0
    59 000001FE 55AA                                       db 0x55,0xaa
    60                                  
